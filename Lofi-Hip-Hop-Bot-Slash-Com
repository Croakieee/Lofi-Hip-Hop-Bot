import nextcord
import yt_dlp
from nextcord import Interaction
from nextcord.ext import commands

intents = nextcord.Intents.all()
intents.voice_states = True
intents.guilds = True
intents.messages = True
intents.presences = True
intents.members = True

bot = commands.Bot(intents=intents)

default_youtube_stream_url = "https://www.youtube.com/watch?v=rUxyKA_-grg&ab_channel=LofiGirl"

async def log_event(message):
    log_channel_name = "bot-üî¨"
    guild = bot.get_guild(1284971289261379664)  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ ID –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
    if guild:
        log_channel = nextcord.utils.get(guild.text_channels, name=log_channel_name)
        if log_channel:
            await log_channel.send(message)
        else:
            print(f"–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫–∞–Ω–∞–ª —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º {log_channel_name}.")
    else:
        print("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å–µ—Ä–≤–µ—Ä.")

@bot.event
async def on_ready():
    print('AIM: –ü—Ä–∏–≤–µ—Ç, –ù–∏–∫–∫–æ–ª–æ! –ì–æ—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±—É—é —Ç–≤–æ—é –∫–æ–º–∞–Ω–¥—É.')
    await log_event("–ë–æ—Ç –ø–æ–¥–∫–ª—é—á—ë–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.")

@bot.slash_command(name="join", description="–ü–æ–¥–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞ –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—É")
async def join(interaction: Interaction):
    channel = interaction.user.voice.channel
    if not interaction.guild.voice_client:
        await channel.connect()
        await interaction.response.send_message("AIM: –ü–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—É.", ephemeral=True)
        await log_event(f"–ë–æ—Ç –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—É {channel}.")
    else:
        await interaction.response.send_message("AIM: –Ø —É–∂–µ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—É.", ephemeral=True)

@bot.slash_command(name="play_radio", description="–ù–∞—á–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–¥–∏–æ")
async def play_radio(interaction: Interaction):
    voice_channel = nextcord.utils.get(bot.voice_clients, guild=interaction.guild)

    if not voice_channel:
        await interaction.response.send_message("AIM: –Ø –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—É. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /join, —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è.", ephemeral=True)
        return

    ydl_opts = {
        'format': 'bestaudio/best',
        'extractaudio': True,
        'audioformat': 'mp3',
        'noplaylist': True,
    }

    try:
        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            info = ydl.extract_info(default_youtube_stream_url, download=False)
            if 'formats' in info:
                audio_url = next((f['url'] for f in info['formats'] if f.get('acodec') != 'none'), None)
                if not audio_url:
                    audio_url = info['formats'][0]['url']
            else:
                audio_url = info['url']
            voice_channel.stop()
            voice_channel.play(nextcord.FFmpegPCMAudio(audio_url))
        await interaction.response.send_message("AIM: –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–¥–∏–æ –Ω–∞—á–∞–ª–æ—Å—å.", ephemeral=True)
    except Exception as e:
        await interaction.response.send_message(f"AIM: –í–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ —Ä–∞–¥–∏–æ - {str(e)}", ephemeral=True)

@bot.slash_command(name="play_other", description="–ù–∞—á–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π YouTube —Å—Å—ã–ª–∫–µ")
async def play_other(interaction: Interaction, url: str):
    voice_channel = nextcord.utils.get(bot.voice_clients, guild=interaction.guild)

    if not voice_channel:
        await interaction.response.send_message("AIM: –Ø –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—É. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /join, —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è.", ephemeral=True)
        return

    ydl_opts = {
        'format': 'bestaudio/best',
        'extractaudio': True,
        'audioformat': 'mp3',
        'noplaylist': True,
    }

    try:
        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            info = ydl.extract_info(url, download=False)
            if 'formats' in info:
                audio_url = next((f['url'] for f in info['formats'] if f.get('acodec') != 'none'), None)
                if not audio_url:
                    audio_url = info['formats'][0]['url']
            else:
                audio_url = info['url']
            voice_channel.stop()
            voice_channel.play(nextcord.FFmpegPCMAudio(audio_url))
        await interaction.response.send_message("AIM: –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–∏–¥–µ–æ –Ω–∞—á–∞–ª–æ—Å—å.", ephemeral=True)
    except Exception as e:
        await interaction.response.send_message(f"AIM: –í–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ - {str(e)}", ephemeral=True)

@bot.slash_command(name="stop", description="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ")
async def stop(interaction: Interaction):
    voice_channel = nextcord.utils.get(bot.voice_clients, guild=interaction.guild)

    if not voice_channel:
        await interaction.response.send_message("AIM: –Ø –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—É.", ephemeral=True)
        return

    if not voice_channel.is_playing():
        await interaction.response.send_message("AIM: –í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è.", ephemeral=True)
        return

    voice_channel.stop()
    await interaction.response.send_message("AIM: –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.", ephemeral=True)

@bot.slash_command(name="thx", description="–°–æ–æ–±—â–µ–Ω–∏–µ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏")
async def thx(interaction: Interaction):
    await interaction.response.send_message("–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É!!!", ephemeral=True)

@bot.slash_command(name="h", description="–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥")
async def h(interaction: Interaction):
    help_message = """
    **AIM: –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**
    
    **/join** ‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –±–æ—Ç–∞ –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—É, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.
    –ü—Ä–∏–º–µ—Ä: `/join`

    **/play_radio** ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ä–∞–¥–∏–æ.
    –ü—Ä–∏–º–µ—Ä: `/play_radio`

    **/play_other <—Å—Å—ã–ª–∫–∞>** ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π YouTube —Å—Å—ã–ª–∫–µ.
    –ü—Ä–∏–º–µ—Ä: `/play_other https://www.youtube.com/watch?v=dQw4w9WgXcQ`

    **/stop** ‚Äî –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ.
    –ü—Ä–∏–º–µ—Ä: `/stop`

    **/thx** ‚Äî –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –æ—Ç –±–æ—Ç–∞. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –≤ —á–∞—Ç–µ.
    –ü—Ä–∏–º–µ—Ä: `/thx`

    **/h** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏.
    –ü—Ä–∏–º–µ—Ä: `/h`
    """
    await interaction.response.send_message(help_message, ephemeral=True)

@bot.slash_command(name="del_messages", description="–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è")
async def del_messages(interaction: Interaction, amount: int):
    if amount < 1 or amount > 100:
        await interaction.response.send_message("AIM: –£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç 1 –¥–æ 100.", ephemeral=True)
        return

    await interaction.channel.purge(limit=amount)
    await interaction.response.send_message(f"AIM: –£–¥–∞–ª–µ–Ω–æ {amount} —Å–æ–æ–±—â–µ–Ω–∏–π.", ephemeral=True)

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.run('YOUR_BOT_TOKEN')
